@model Webapp.Models.Payment

@{
    ViewBag.Title = "Create";
    AjaxOptions ajaxOptions = new AjaxOptions()
    {
        UpdateTargetId = "tbody",
        InsertionMode = InsertionMode.InsertAfter,
        OnComplete = "onComplete"
    };
}
<div class="row">
    <div class="col-lg-12">
        <h1 class="page-header">Rentar <a href="@Url.Action("Index")" class="btn btn-primary pull-right"><i class="fa fa-arrow-circle-left"></i> volver a la lista</a></h1>
    </div>
    <!-- /.col-lg-12 -->
</div>

<div class="col-md-6">
    @using (Html.BeginForm())
    {
        @Html.AntiForgeryToken()

        <div class="form-horizontal">
            @Html.ValidationSummary(true, "", new { @class = "text-danger" })
            <div class="form-group">
                <label class="control-label col-md-2">Socio</label>
                <div class="col-md-10">
                    @Html.DropDownList("CustomerId", null, htmlAttributes: new { @class = "form-control" })
                    @Html.ValidationMessageFor(model => model.CustomerId, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group">
                <label class="control-label col-md-2">Usuario creador</label>
                <div class="col-md-10">
                    @Html.DropDownList("ApplicationUserId", null, htmlAttributes: new { @class = "form-control" })
                    @Html.ValidationMessageFor(model => model.ApplicationUserId, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group">
                Monto total
                <div class="col-md-10">
                    <input type="text" readonly="" id="amount" class="form-control"/>
                    <input type="hidden" readonly="" name ="TotalAmount" id="totalAmount" class="form-control"/>
                </div>
            </div>
            <table id="dataTables-example" class="table table-striped table-bordered table-hover">

                <thead>
                    <tr>
                        <th>
                            Pelicula
                        </th>
                        <th>
                            Precio
                        </th>
                        <th>
                            Fecha de devolucion
                        </th>

                        <th></th>
                    </tr>
                </thead>
                <tbody id="tbody"></tbody>
            </table>
            <div class="form-group">
                <div class="col-md-offset-2 col-md-10">
                    <input type="submit" value="Guardar" class="btn btn-default" />
                </div>
            </div>
        </div>
    }
</div>
<div class="col-md-6">
    @using (Ajax.BeginForm("createRent", "Payments", ajaxOptions))
    {


        <div class="form-horizontal">
            @Html.AntiForgeryToken()
            

            <div class="form-group">
                <label class="control-label col-md-2">Socio</label>
                <div class="col-md-10">
                    @Html.DropDownList("CustomerId", null, htmlAttributes: new { @class = "form-control" })
                    @Html.ValidationMessageFor(model => model.CustomerId, "", new { @class = "text-danger" })
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-md-2">Pelicula</label>
                <div class="col-md-10">
                    @Html.DropDownList("RentMovieId", null, htmlAttributes: new { @class = "form-control" })
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-md-2">Fecha de retorno</label>
                <div class="col-md-10">
                    <input type="date" name="ReturnDate" class = "form-control" />
                   
                </div>
            </div>
            <div class="form-group">
                <div class="col-md-offset-2 col-md-10">
                    <input type="submit" value="Rentar" class="btn btn-default" />
                </div>
            </div>
        </div>
    }
</div>
@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    @Scripts.Render("~/bundles/jqueryunob")

    <script>
        function deleteRow(parameters) {
            $('#' + parameters).remove();
            sumRows();
        }

        function onComplete() {
            sumRows();
        }

        function sumRows() {
            var totals = 0;
           var $dataRows = $("#tbody tr");
            $dataRows.each(function () {
                $(this).find('.rowDataSd').each(function (i) {
                    totals+= parseInt($(this).html());
                });
            });
            $('#totalAmount').val(totals);
            $('#amount').val(totals);
            
        }
    </script>
}
